import {
    Button,
    Dialog,
    DialogActions,
    DialogContent,
    DialogTitle,
    Icon,
    IconButton,
    WithStyles,
    withStyles
}                                    from 'material-ui';
import { CollDefinitionModelField }  from 'props-cms.connector-common';
import * as React                    from 'react';
import { SimpleTextField }           from '../../../util/index';
import CollDefinitionFieldList       from './editorFieldSettings';
import { CollDefinitionFieldTypeUI } from './typeNames';

const styles = {
    row: {
        padding: '0.5rem 1rem',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between'
    } as React.CSSProperties,
    rowActions: {
        flexShrink: 0
    }
};

const decorateStyles = withStyles(styles);

type CollDefinitionFieldEditorProps = {
    field: CollDefinitionModelField;
    onDataChange: (data: Partial<CollDefinitionModelField>) => void;
    onDelete: () => void;
} & WithStyles<keyof typeof styles>;

class CollDefinitionFieldEditor extends React.PureComponent<CollDefinitionFieldEditorProps, {
    editorOpen: boolean;
}> {

    constructor(props: CollDefinitionFieldEditorProps) {
        super(props);
        this.state = {
            editorOpen: false
        };
    }

    render() {

        const { field, onDataChange, onDelete, classes } = this.props;

        return (
            <div>
                {this.state.editorOpen && (
                    <Dialog
                        open={true}
                        onClose={() => this.setState({ editorOpen: false })}
                    >
                        <DialogTitle>
                            {field.label}
                        </DialogTitle>
                        <DialogContent>
                            <CollDefinitionFieldList
                                field={field}
                                onDataChange={onDataChange}
                            />
                        </DialogContent>
                        <DialogActions>
                            <Button onClick={() => this.setState({ editorOpen: false })}>
                                OK
                            </Button>
                        </DialogActions>
                    </Dialog>
                )}
                <div className={classes.row}>
                    {CollDefinitionFieldTypeUI[field.type].name}
                    <SimpleTextField
                        TextFieldProps={{
                            fullWidth: true,
                            InputProps: {
                                disableUnderline: true
                            }
                        }}
                        label={'Key'}
                        value={field.key}
                        onBlur={value => onDataChange({ key: value })}
                    />
                    <SimpleTextField
                        TextFieldProps={{
                            fullWidth: true,
                            InputProps: {
                                disableUnderline: true
                            }
                        }}
                        label={'Label'}
                        value={field.label}
                        onBlur={value => onDataChange({ label: value })}
                    />
                    <div className={classes.rowActions}>
                        <IconButton onClick={() => this.setState({ editorOpen: true })}>
                            <Icon>edit</Icon>
                        </IconButton>
                        <IconButton onClick={onDelete}>
                            <Icon>delete</Icon>
                        </IconButton>
                    </div>
                </div>
            </div>
        );
    }
}

export default decorateStyles(CollDefinitionFieldEditor);